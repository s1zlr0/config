import yaml
import sys

def load_config(config_path='config.yaml'):
    try:
        with open(config_path, 'r') as file:
            config = yaml.safe_load(file)
            if config is None:
                print("Ошибка: config.yaml пустой")
                sys.exit(1)
            return config
    except FileNotFoundError:
        print(f"Ошибка: файл {config_path} не найден")
        sys.exit(1)
    except yaml.YAMLError as e:
        print(f"Ошибка в формате YAML: {e}")
        sys.exit(1)
    except Exception as e:
        print(f"Неожиданная ошибка: {e}")
        sys.exit(1)

def validate_config(config):
    "Проверяет корректность конфигурации"
    required_fields = {
        'package_name': str,
        'repository_url': str,
        'test_mode': bool,
        'ascii_tree': bool,
        'max_depth': int
    }
    
    
    for field, field_type in required_fields.items():
        if field not in config:
            print(f"Ошибка: отсутствует обязательное поле '{field}'")
            sys.exit(1)
        
        
        if not isinstance(config[field], field_type):
            print(f"Ошибка: поле '{field}' должно быть типа {field_type.__name__}, получено {type(config[field]).__name__}")
            sys.exit(1)
    
    
    if config['max_depth'] < 1:
        print("Ошибка: max_depth должен быть целым числом больше 0")
        sys.exit(1)
    
    if not config['package_name'].strip():
        print("Ошибка: package_name не может быть пустым")
        sys.exit(1)

def main():
    try:
        config = load_config()
        validate_config(config)
        print(" Конфигурационные параметры ")
        for key, value in config.items():
            print(f"{key}: {value}")
            
    except KeyboardInterrupt:
        print("\nПрограмма прервана пользователем")
        sys.exit(1)
    except Exception as e:
        print(f"Критическая ошибка: {e}")
        sys.exit(1)

if __name__ == "__main__":
    main()
